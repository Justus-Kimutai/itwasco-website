---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getPostBySlug } from "../../lib/supabase";

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect("/blog");
}

const post = await getPostBySlug(slug);

if (!post) {
  return Astro.redirect("/blog");
}
---

<BaseLayout
  title={post.title}
  description={post.excerpt}
>
  <!-- Article Header -->
  <section class="bg-gradient-to-br from-primary-50 to-white py-8 sm:py-16">
    <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
      <nav class="mb-4 text-sm text-gray-500">
        <a href="/" class="hover:text-primary-600">Home</a>
        <span class="mx-2">/</span>
        <a href="/blog" class="hover:text-primary-600">Blog</a>
        <span class="mx-2">/</span>
        <span class="text-gray-900">{post.title}</span>
      </nav>

      <h1 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl lg:text-5xl">
        {post.title}
      </h1>

      <div class="mt-4 flex flex-wrap items-center gap-4 text-sm text-gray-500">
        <time datetime={post.created_at} class="flex items-center gap-1">
          <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          {new Date(post.created_at || '').toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          })}
        </time>
        <span class="flex items-center gap-1">
          <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          {post.author || 'ITWASCO Team'}
        </span>
      </div>
    </div>
  </section>

  <!-- Article Content -->
  <section class="py-8 sm:py-16">
    <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
      <article class="overflow-hidden rounded-2xl bg-white shadow-lg">
        {post.image_url && (
          <div class="aspect-video w-full overflow-hidden">
            <img
              src={post.image_url}
              alt={post.title}
              class="h-full w-full object-cover"
            />
          </div>
        )}

        <div class="p-6 sm:p-10">
          <div class="prose prose-lg max-w-none text-gray-600" set:html={post.content.replace(/\n/g, '<br />')} />
        </div>
      </article>

      <!-- Back to Blog -->
      <div class="mt-8 text-center">
        <a
          href="/blog"
          class="inline-flex items-center gap-2 text-primary-600 font-semibold hover:text-primary-700 transition-colors"
        >
          <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Back to Blog
        </a>
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="py-16">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="rounded-2xl bg-primary-600 px-8 py-12 text-center sm:px-12">
        <h2 class="text-2xl font-bold text-white sm:text-3xl">
          Have Questions?
        </h2>
        <p class="mx-auto mt-4 max-w-xl text-primary-100">
          Get in touch with us for any inquiries about our services or upcoming projects.
        </p>
        <a
          href="/contact"
          class="mt-6 inline-flex items-center justify-center rounded-lg bg-white px-6 py-3 font-semibold text-primary-600 transition-colors hover:bg-primary-50"
        >
          Contact Us
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
